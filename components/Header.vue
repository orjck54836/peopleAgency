<script setup lang="ts">
import { useI18n } from 'vue-i18n';
import { computed } from 'vue';

// 接收父層傳來的 props
defineProps<{
  navOpen: boolean;
  toggleNav: () => void;
  classes?: string;
}>();

// i18n 設定
const { locale, locales } = useI18n();

// 可用語言選單
const availableLocales = computed(() =>
  locales.value.map((l) => ({
    code: l.code,
    name: l.code === 'en' ? 'English' : l.code === 'zh-tw' ? '繁體中文' : '日本語'
  }))
);

// 取得當前語言名稱
const currentLanguageName = computed(() => {
  const current = availableLocales.value.find((l) => l.code === locale.value);
  return current ? current.name : 'Language';
});

// 切換語言
const switchLang = (lang: string) => {
  locale.value = lang;
};
</script>

<template>
  <header class="header">
    <div class="container-fluid d-flex align-items-center justify-content-between">
      <NuxtLink to="/" :class="classes">
        <img src="/images/logo.png" alt="logo" />
      </NuxtLink>

      <!-- 語言切換下拉選單 -->
      <div class="dropdown">
        <button
          class="btn btn-secondary dropdown-toggle"
          type="button"
          id="languageDropdown"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          {{ currentLanguageName }}
        </button>
        <ul class="dropdown-menu" aria-labelledby="languageDropdown">
          <li v-for="locale in availableLocales" :key="locale.code">
            <button class="dropdown-item" @click="switchLang(locale.code)">
              {{ locale.name }}
            </button>
          </li>
        </ul>
      </div>

      <button @click="toggleNav" class="bg-transparent border-0 d-xl-none">
        <div :class="{ open: navOpen }" class="nav-icon">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </button>
    </div>
  </header>
</template>

<style lang="scss">
.header {
  padding: 14px 0;
  width: 100%;
  z-index: 1050;
  left: 0;
  right: 0;
  backdrop-filter: blur(3px);
  position: fixed;
  img {
    max-width: 100%;
  }
  .dropdown-menu {
    background-color: rgb(var(--background)); /* 柔和米白色背景 */
    border: 2px solid rgba(var(--contrast), 0.2); /* 細緻的邊框 */
    border-radius: 10px; /* 圓角，讓畫面更柔和 */
    box-shadow: 4px 4px 12px rgba(var(--contrast), 0.15), -4px -4px 12px rgba(var(--background), 0.2);
    overflow: hidden; /* 防止圓角溢出 */
    padding: 10px 0;
    min-width: 180px;
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
  }

  /* 🔹 顯示選單時的動畫 */
  .dropdown-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(10px);
  }

  /* 🔹 語言選項樣式 */
  .dropdown-menu li {
      list-style: none;
      padding: 8px 15px;
      font-size: 1rem;
      color: rgb(var(--contrast)); /* 文字用暖灰色 */
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
      text-align: center;
  }

  /* 🔹 選單懸停時的效果 */
  .dropdown-menu li:hover {
      background-color: rgba(var(--primary), 0.2); /* 柔和木質感懸停效果 */
      color: rgb(var(--secondary)); /* 變成較深的木色 */
      border-radius: 8px;
  }

  /* 🔹 選中的語言 */
  .dropdown-menu li.active {
      font-weight: bold;
      color: rgb(var(--secondary)); /* 蜂蜜棕 */
  }

  /* 🔹 下拉箭頭（美化開關按鈕） */
  .dropdown-toggle {
      background-color: transparent;
      border: none;
      color: rgb(var(--contrast));
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: color 0.3s ease-in-out;
  }

  /* 🔹 滑鼠懸停時變化 */
  .dropdown-toggle:hover {
      color: rgb(var(--secondary)); /* 深一點的木質色 */
  }

  /* 🔹 選單箭頭動畫 */
  .dropdown-toggle::after {
      content: "▼";
      font-size: 0.8rem;
      transition: transform 0.3s ease-in-out;
  }

  /* 🔹 當選單展開時箭頭旋轉 */
  .dropdown-menu.show + .dropdown-toggle::after {
      transform: rotate(180deg);
  }

  .nav-icon {
    width: 36px;
    height: 22px;
    position: relative;
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
    -webkit-transition: 0.5s ease-in-out;
    -moz-transition: 0.5s ease-in-out;
    -o-transition: 0.5s ease-in-out;
    transition: 0.5s ease-in-out;
    cursor: pointer;
    z-index: 15;
    span {
      display: block;
      position: absolute;
      height: 2px;
      width: 100%;
      background: rgb(var(--black));
      opacity: 1;
      left: 0;
      -webkit-transform: rotate(0deg);
      -moz-transform: rotate(0deg);
      -o-transform: rotate(0deg);
      transform: rotate(0deg);
      -webkit-transition: 0.25s ease-in-out;
      -moz-transition: 0.25s ease-in-out;
      -o-transition: 0.25s ease-in-out;
      transition: 0.25s ease-in-out;
    }
  }
  .nav-icon span:nth-child(1) {
    top: 0px;
  }

  .nav-icon span:nth-child(2) {
    top: 10px;
  }

  .nav-icon span:nth-child(3) {
    top: 20px;
  }

  .nav-icon.open span:nth-child(1) {
    top: 10px;
    -webkit-transform: rotate(135deg);
    -moz-transform: rotate(135deg);
    -o-transform: rotate(135deg);
    transform: rotate(135deg);
    background-color: rgb(var(--white));
  }

  .nav-icon.open span:nth-child(2) {
    opacity: 0;
    left: -60px;
  }

  .nav-icon.open span:nth-child(3) {
    top: 10px;
    -webkit-transform: rotate(-135deg);
    -moz-transform: rotate(-135deg);
    -o-transform: rotate(-135deg);
    transform: rotate(-135deg);
    background-color: rgb(var(--white));
  }
}
</style>
